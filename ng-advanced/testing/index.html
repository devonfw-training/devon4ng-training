<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Angular Advanced - Testing</title>

    <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
    <link rel="icon" href="./img/favicon.ico">
    <link rel="stylesheet" href="./reveal.js/css/reveal.css">
    <link rel="stylesheet" href="./reveal.js/css/theme/simple.css">
    <link rel="stylesheet" href="./css/common.css">
    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="./css/github-gist.css">

</head>

<body>
    <div class="reveal">
        <section class="slides">
            <section class="fullscreen" data-background="url(./img/Fixed_Shape_3_CapgeminiBlue_RGB.svg) no-repeat 0 500px">
                <div class="header-bottom-left">
                    <h3 class="cap-white">Unit Testing</h3>
                    <h4 class="cap-white">Philipp Huber</h4>
                </div>
            </section>

            <section id="agenda-1" data-transition="slide" class="fullscreen" data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                <h2 class="header white">Agenda</h2>

                <body class="white">
                    <ul>
                        <li>
                            <a href="#/basics">Basics</a>
                        </li>
                        <li>
                            <a href="#/mocking">Mocking</a>
                        </li>
                        <li>
                            <a href="#/async">Testing asynchronous code</a>
                        </li>
                        <li>
                            <a href="#/pacts">Pact</a>
                        </li>
                        <!--<li>-->
                        <!--<a href="#/router-events">Testing router events</a>-->
                        <!--</li>-->

                    </ul>
                </body>
            </section>

            <!-- Basics -->
            <section class="fullscreen">
                <section id="basics" data-transition="slide">
                    <h2 class="header">Examples</h2>

                    <body class="">
                        <a href="https://github.com/devonfw-ng-adv-training/devonfw-testing">
                            https://github.com/devonfw-ng-adv-training/devonfw-testing</a>
                    </body>
                </section>
                <section data-transition="slide">
                    <h2 class="header ">Why unit tests?</h2>

                    <body class="">
                        <ul>
                            <li>
                                recognize bad component design
                            </li>
                            <li>
                                easy to refactor application
                            </li>
                            <li>
                                implement new features without breaking old ones
                            </li>
                        </ul>
                    </body>
                </section>
                <section data-transition="slide">
                    <h2 class="header">How to keep your code testable (& maintainable & readable...)?</h2>

                    <body class="">
                        <ul>
                            <li>
                                Dumb & Smart
                            </li>
                            <li>
                                Thin & Fat
                            </li>
                        </ul>
                    </body>
                </section>
                <section data-transition="slide">
                    <h2 class="header ">Template (HTML) = Dumb & Declarative</h2>

                    <body class="">
                        <img height="300em" class="no-background no-border no-margin no-shadow" src="./img/donald-trump.jpg">
                        <ul>
                            <li>
                                Declarative code says WHAT to do
                            </li>
                            <li>
                                Avoid complicated logic
                            </li>
                            <li>Small and simple</li>
                            <li>*ngIf</li>
                            <li>knows its component & its sub-component</li>
                        </ul>
                    </body>
                </section>
                <section data-transition="slide">
                    <h2 class="header ">Component (TS / Controller) = Smart & Thin</h2>

                    <body class="">
                        <img height="300em" class="no-background no-border no-margin no-shadow" src="./img/tesla.png">
                        <ul>
                            <li>Manage the view</li>
                            <li>Invoke Services</li>
                            <li>No http</li>
                            <li>Smarter = Fatter?</li>
                            <li>Component decides, services processes</li>
                            <li>as thin as possible - but no thinner.</li>
                        </ul>
                    </body>
                </section>
                <section data-transition="slide">
                    <h2 class="header ">Services = Fat, Happy and Specific</h2>

                    <body class="">
                        <img height="300em" class="no-background no-border no-margin no-shadow" src="./img/sumo.gif">
                        <ul>
                            <li>holds business logic</li>
                            <li>fatten services, starve components</li>
                            <li>SOLID (Single Responsible & Interface Segregation most importantly)</li>
                            <li>may manage state or have no state at all</li>
                        </ul>
                    </body>
                </section>
                <section data-transition="slide">
                    <h2 class="header ">Basics / jasmine</h2>

                    <body class="">
                        <ul>
                            <li>
                                suites: describe(string, function)
                            </li>
                            <li>
                                specs: it(string, function)
                            </li>
                            <li>
                                expectations: expect(actual)...
                            </li>
                            <li>
                                matchers: toBe(expected), toEqual(expected)...
                            </li>
                        </ul>
                    </body>
                </section>
                <section data-transition="slide">
                    <h2 class="header ">.. / setup & teardown</h2>

                    <body class="">
                        <ul>
                            <li>
                                beforeAll
                            </li>
                            <li>
                                beforeEach
                            </li>
                            <li>
                                afterEach
                            </li>
                            <li>
                                afterAll
                            </li>
                        </ul>
                    </body>
                </section>
            </section>

            <!-- Child components -->
            <section class="fullscreen">
                <section id="mocking" data-transition="slide" data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                    <h2 class="header white">Why mocking?</h2>

                    <body class="white">
                        <ul>
                            <li>
                                more isolated testing
                            </li>
                            <li>
                                strongly typed template checking
                            </li>
                            <li>
                                less coupling between components and services
                            </li>
                            <li>
                                prefer dumb components over smart components
                            </li>
                        </ul>
                    </body>
                </section>
                <section data-transition="slide" data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                    <h2 class="header white">how to handle child components</h2>

                    <body class="white">
                        <ul>
                            <li>
                                do not mock: use real component
                            </li>
                            <li>
                                Use NO_ERRORS_SCHEMA
                            </li>
                            <li>
                                Mock component
                            </li>
                            <li>
                                use mocking framework like <a href="https://github.com/ike18t/ng-mocks">ng-mocks
                                    <div style="font-size: small; text-align: right;">works for modules too</div></a>
                            </li>
                        </ul>
                    </body>
                </section>

                <section class="fullscreen" data-transition="slide" data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                    <h2 class="header white">how to mock services?</h2>

                    <body class="white">
                        <ul>
                            <li>
                                do not mock: use real service..
                            </li>
                            <li>
                                useClass: MockClass
                            </li>
                            <li>
                                useValue: return {}
                            </li>
                            <li>
                                use jasmine.spy
                            </li>
                        </ul>
                    </body>
                </section>

            </section>

            <!-- Async -->
            <section class="fullscreen">
                <section id="async" data-transition="slide" data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                    <h2 class="header white">Testing asynchronous code</h2>

                    <body class="white">
                        <ul>
                            <li>
                                async
                            </li>
                            <li>
                                fakeAsync
                            </li>
                            <li>
                                done
                            </li>
                        </ul>
                    </body>
                </section>
                <section data-transition="slide" data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                    <h3 class="header white">async</h3>

                    <body class="white">
                        <pre style="margin: 0; width: 100%"><code class="hljs ts" data-trim>
it('should show quote after getQuote (async)', async(() => {
  fixture.detectChanges(); // ngOnInit()
  expect(quoteEl.textContent).toBe('...', 'should show placeholder');

  fixture.whenStable().then(() => { // wait for async getQuote
    fixture.detectChanges();        // update view with quote
    expect(quoteEl.textContent).toBe(testQuote);
    expect(errorMessage()).toBeNull('should not show error');
  });
}));
            </code></pre>

                        <small>
                            <a
                                href="https://angular.io/guide/testing#async-test-with-async">https://angular.io/guide/testing#async-test-with-async</a>
                        </small>
                    </body>
                </section>
                <section data-transition="slide" data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                    <h3 class="header white">fakeAsync</h3>

                    <body class="white">
                        <pre style="margin: 0; width: 100%"><code class="hljs ts" data-trim>
it('Button label via fakeAsync() and tick()', fakeAsync(() => {
  expect(el.nativeElement.textContent.trim()).toBe('');
  fixture.detectChanges();
  expect(el.nativeElement.textContent.trim()).toBe('Login');
  spyOn(authService, 'isAuthenticated').and
                    .returnValue(Promise.resolve(true));
  component.ngOnInit();

  tick();
  fixture.detectChanges();
  expect(el.nativeElement.textContent.trim()).toBe('Logout');
}));
            </code></pre>

                        <small>
                            <a
                                href="https://angular.io/guide/testing#async-test-with-fakeasync">https://angular.io/guide/testing#async-test-with-fakeasync</a>
                        </small>
                    </body>
                </section>
                <section data-transition="slide" data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                    <h3 class="header white">done</h3>

                    <body class="white">
                        <pre style="margin: 0; width: 100%"><code class="hljs ts" data-trim>
it('should show last quote (quote done)', (done: DoneFn) => {
  fixture.detectChanges();

  component.quote.pipe( last() ).subscribe(() => {
    fixture.detectChanges(); // update view with quote
    expect(quoteEl.textContent).toBe(testQuote);
    expect(errorMessage()).toBeNull('should not show error');
    done();
  });
});
            </code></pre>

                        <small>
                            <a
                                href="https://angular.io/guide/testing#jasmine-done">https://angular.io/guide/testing#jasmine-done</a>
                        </small>
                    </body>
                </section>
            </section>

            <!-- pact -->
            <section class="fullscreen">
                <section id="pacts" data-transition="slide" data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                    <h2 class="header white">consumer-driven contract testing</h2>

                    <body class="white">
                        <ul>
                            <li>
                                consumer defines requirements
                            </li>
                            <li>
                                for an api of provider
                            </li>
                            <li>
                                via tests
                            </li>
                            <li>
                                generate contract via pact
                            </li>
                            <li>
                                provider tests all contract files in build pipeline
                            </li>
                        </ul>
                    </body>
                </section>
                <section data-transition="slide" data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                    <h3 class="header white">pact / interface</h3>

                    <img height="300em" class="no-background no-border no-margin no-shadow" src="./img/pact-basic-interface.JPG">
                    <!--Image taken from FT Testing days presentation -->
                </section>
                <section data-transition="slide" data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                    <h3 class="header white">pact / consumer</h3>

                    <img height="400em" class="no-background no-border no-margin no-shadow" src="./img/pact-consumer.JPG">
                    <!--Image taken from FT Testing days presentation -->
                </section>
                <section data-transition="slide" data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                    <h3 class="header white">pact / provider</h3>

                    <img height="400em" class="no-background no-border no-margin no-shadow" src="./img/pact-provider.JPG">
                    <!--Image taken from FT Testing days presentation -->
                </section>
                <section data-transition="slide" data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                    <h3 class="whheader whiteite">consumer code (java spring)</h3>

                    <body class="white">
                        <pre style="margin: 0; width: 100%"><code class="hljs ts" data-trim>
@RunWith(SpringRestPactRunner.class)
@Provider("book-service")
@PactFolder("pacts")
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
public class ContractTest {

  @TestTarget
  public final Target target = new SpringBootHttpTarget();

  @State("Books exist")
  public void user1Exists() {
    // nothing to do, real service is used
  }
}
            </code></pre>
                    </body>
                </section>
            </section>

    </div>
    </div>


    <script src="./reveal.js/js/reveal.js"></script>

    <script>
        // More info https://github.com/hakimel/reveal.js#configuration
        Reveal.initialize({
            width: '100%',
            height: '100%',
            history: true,

            // More info https://github.com/hakimel/reveal.js#dependencies
            dependencies: [{
                src: './reveal.js/lib/js/classList.js',
                condition: function() {
                    return !document.body.classList;
                }
            }, {
                src: './reveal.js/plugin/markdown/marked.js',
                condition: function() {
                    return !!document.querySelector('[data-markdown]');
                }
            }, {
                src: './reveal.js/plugin/markdown/markdown.js',
                condition: function() {
                    return !!document.querySelector('[data-markdown]');
                }
            }, {
                src: './reveal.js/plugin/highlight/highlight.js',
                async: true,
                callback: function() {
                    hljs.initHighlightingOnLoad();
                }
            }, {
                src: './reveal.js/plugin/zoom-js/zoom.js',
                async: true
            }, {
                src: './reveal.js/plugin/notes/notes.js',
                async: true
            }]
        });
    </script>
</body>

</html>