<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Angular Advanced - Forms</title>


    <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
    <link rel="icon" href="./img/favicon.ico">
    <link rel="stylesheet" href="./reveal.js/css/reveal.css">
    <link rel="stylesheet" href="./reveal.js/css/theme/simple.css">
    <link rel="stylesheet" href="./css/common.css">
    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="./css/github-gist.css">
</head>

<body>
    <div class="reveal">
        <div class="slides">
            <section class="fullscreen"
                data-background="url(./img/Fixed_Shape_3_CapgeminiBlue_RGB.svg) no-repeat 0 500px">
                <div class="header-bottom-left">

                    <h1 class="cap-white">Forms</h1>
                    <p class="cap-white">March 2019 State</p>
                </div>
            </section>

            <section id="agenda-1" data-transition="slide"
                data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                <h2 class="cap-white">Agenda</h2>
                <ul class="cap-white">
                    <li>Recap: Template Driven & Reactive Forms</li>
                    <li>Custom Form Controls</li>
                    <li>Nested Forms</li>
                    <ul class="cap-white">
                        <li>with Form Group Directive</li>
                        <li>with Control Value Accessor</li>
                    </ul>
                </ul>
            </section>

            <section>
                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Template Driven & Reactive Forms</h3>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Template Driven Forms</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Template as the source of truth</h5>
                    <ul class="cap-white">
                        <li>Normally <strong>simple forms </strong>such as email or sign up form</li>
                        <li>They are <strong>asynchronous</strong></li>
                        <li><strong>Two way</strong> data binding</li>
                        <li><strong>Testing</strong> is more difficult</li>
                        <li>They don't <strong>scale </strong>well</li>
                        <li>Use if the forms and forms logic in your app are <strong>simple</strong></li>
                    </ul>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Template Driven Forms</h3>
                    <h5 class="cap-white">Example</h5>
                    <pre><code>
@Component({
  selector: "app-login",
  template: `
     <form #form="ngForm" (submit)="submit(form.value)">
       <input type="email" [ngModel]="email" name="email">
       <input type="submit" value="submit">
     </form>
  `
})
export class LoginComponent {
  email = '';

  @ViewChild('form') form: FormGroup;

  submit(value) {
    console.log(value);
  }

}
                </code></pre>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Template Driven Forms</h3>
                    <img src="img/template-driven-forms.png" class="no-background no-border no-margin no-shadow">
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Reactive Forms</h3>
                    <h5 class="cap-white" style="color: #10e0ff">The form model as the source of truth</h5>
                    <ul class="cap-white">
                        <li>More <strong>scalable, reusable and testable </strong></li>
                        <li>They are <strong>synchronous</strong></li>
                        <li><strong>Immutable</strong></li>
                    </ul>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Reactive Forms</h3>
                    <h5 class="cap-white">Example</h5>
                    <pre><code>
@Component({
  selector: "app-login",
  template: `
     <form [formGroup]="loginForm" (submit)="submit()">
       <input type="email" formControlName="email">
       <input type="submit" value="submit">
     </form>
  `
})
export class LoginComponent implements OnInit {
  loginForm: FormGroup;

  ngOnInit() {
    this.loginForm = new FormGroup({
      email: new FormControl()
    });
  }

  submit() {
    console.log(this.loginForm.value);
  }

}
                </code>
                </pre>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Reactive Forms</h3>
                    <img src="img/reactive-forms.png" class="no-background no-border no-margin no-shadow">
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Template Driven vs. Reactive Forms</h3>
                    <table class="cap-white">
                        <thead>
                            <tr>
                                <th></th>
                                <th style="color: #10e0ff">Template Driven</th>
                                <th style="color: #10e0ff">Reactive</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Form model</td>
                                <td>HTML template</td>
                                <td>Defined in a component</td>
                            </tr>
                            <tr>
                                <td>Data model</td>
                                <td>Unstructured</td>
                                <td>Structured</td>
                            </tr>
                            <tr>
                                <td>Predictability</td>
                                <td>Asynchronous</td>
                                <td>Synchronous</td>
                            </tr>
                            <tr>
                                <td>Form validation</td>
                                <td>Directives</td>
                                <td>Functions</td>
                            </tr>
                            <tr>
                                <td>Mutability</td>
                                <td>Mutable</td>
                                <td>Immutable</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

            </section>

            <section>
                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Custom Form Control</h3>
                    <h5 class="cap-white" style="color: #10e0ff">With Control Value Accessor</h5>
                    <blockquote class="cap-white">
                        CVA - is an interface that acts as a <strong>bridge </strong>between the <strong>Angular
                            forms
                            API </strong>and a <strong>native element in the DOM</strong>.
                    </blockquote>
                    <span class="cap-white">It propagates changes from the <span
                            style="color: #10e0ff"><strong>model</strong></span> to the <span
                            style="color: #10e0ff"><strong>view</strong></span>
                        and from the <span style="color: #10e0ff"><strong>view</strong></span> to the <span
                            style="color: #10e0ff"><strong>model</strong></span></span>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Control Value Accessor</h3>
                    <img src="img/cva.jpeg" class="no-background no-border no-margin no-shadow">
                    <!--Image taken from: https://blog.angularindepth.com/never-again-be-confused-when-implementing-controlvalueaccessor-in-angular-forms-93b9eee9ee83-->
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Control Value Accessor</h3>
                    <h5 class="cap-white" style="color: #10e0ff">API</h5>
                    <pre><code>
// is the method that writes a new value from the form model
// into the view or (if needed) DOM property
writeValue(obj: any)
// is a method that registers a handler that should be called
// when something in the view has changed
registerOnChange(fn: any)
// it registers a handler specifically for when a control receives
// a touch event
registerOnTouched(fn: any)
                </code></pre>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Control Value Accessor</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Implementation steps</h5>
                    <ul class="cap-white">
                        <li>Implement ControlValueAccessor interface and implement its methods</li>
                        <li>Register ControlValueAccessor (in a Component)</li>
                    </ul>
                    <pre><code>
providers: [
    {
      provide: NG_VALUE_ACCESSOR,
      useExisting: forwardRef(() => CustomComponent),
      multi: true
    }
  ]
                </code></pre>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Control Value Accessor</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (1/5)</h5>
                    <ol class="cap-white">
                        <li>Pull or fork a repository from <a href="https://github.com/phhbr/forms-cva">here</a></li>
                        <li>Check out the master state</li>
                        <li>Get to know the application</li>
                    </ol>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Control Value Accessor</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (2/5)</h5>
                    <p class="cap-white">We want to implement a dropwndown selection for 'Genre' in the book detail
                        page.</p>
                    <ol class="cap-white">
                        <ul>
                            <li>Create a custom control component with a select box (ng g c customized-select-box)
                                <p style="font-size:smaller">where will you create it?</p>
                            </li>
                            <li>Define customized select box template - the list should consist of the item's name (i.e. genre name)
                                <p>use select for the select box</p>
                                <p>use option for the list items</p>
                                <p>fill options via input</p>
                            </li>
                            </p>
                        </ul>
                            <ul>
                                <p style="font-size:smaller">more advanced material users: you may use the following material components
                                <li style="font-size:smaller">Use mat-select for the list</li>
                                <li style="font-size:smaller">Use mat-option</li>
                                <li style="font-size:smaller">Documentation can be found <a
                                        href="https://material.angular.io/components/select/overview">here</a></li>
                            </ul>
                        </ul>
                    </ol>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Control Value Accessor</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (3/5)</h5>
                    <ol class="cap-white">
                        <p class="cap-white">Implement ControlValueAccessor</p>
                        <ul>
                            <li>Use your new component in the book detail component</li>
                            <li>use the input and fill it with genres</li>
                            <li>Test your application</li>
                            <li style="font-size:smaller">fallback branch: cva/1-select-options-added</li>
                        </ul>
                    </ol>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Control Value Accessor</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (4/5)</h5>
                    <ul class="cap-white">
                        <li>Make the select box component part of your Form Control Group via formControlName</li>
                        <li>The SelectBoxComponent shall implement the ControlValueAccessor interface</li>
                        <li>The SelectBoxComponent shall have one formControl</li>
                        <li>Implement following methods</li>
                        <ul>
                            <li>writeValue</li>
                            <li>registerOnChange</li>
                        </ul>
                        <li>Add Genres to existing books in backend, extend book class by genre (number)</li>
                        <li style="font-size:smaller">fallback branch: cva/2-adding-control-value-accessor</li>
                    </ul>
                </section>

                <section class="cap-white"
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Control Value Accessor</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (5/5)</h5>
                    <ul class="cap-white">
                        <li>Register CVA in the application</li>
                    </ul>
                    <p style="font-size:smaller">Don't forget to register new services and components in the modules<p>
                    <li style="font-size:smaller">fancy solution with material, resolvers etc: cva/3-final</li>
                </section>
            </section>


            <section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Nested Forms</h3>
                    <h5 class="cap-white" style="color: #10e0ff">With Form Group Directive</h5>
                    <span class="cap-white">Control Container looks in the tree for any of these directives (looks for a
                        parent):</span>
                    <ul class="cap-white">
                        <li>ngForm</li>
                        <li>FormGroupDirective</li>
                        <li>NgModelGroup</li>
                        <li>FormGroupName</li>
                        <li>FormArrayName</li>
                    </ul>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">With Form Group Directive</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Implementation</h5>
                    <pre><code>
viewProviders: [
    { provide: ControlContainer, useExisting: FormGroupDirective }
  ]
                </code></pre>
                    <span class="cap-white">ViewProviders instead of providers: providers cannot reach up the parent (if
                        the
                        structure is complex)</span>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">With Form Group Directive</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Pros & cons</h5>
                    <ul class="cap-white">
                        <li>Pro: quicker to set up</li>
                        <li>Con: limited to one forms module</li>
                    </ul>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">With Form Group Directive</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (1/3)</h5>
                    <ol class="cap-white">
                        <li>Start on branch nested/fgd-0-start</li>
                        <li>Create an order module (ng g m order)</li>
                        <li>Create order-overview component (ng g c order-overview)</li>
                        <ul class="cap-white">
                            <li>This is the parent form - add [formGroup] directive</li>
                            <li>Add apply and cancel buttons</li>
                            <li>On apply show the form (rawValue) in the console</li>
                            <li>Form can be submitted only if it's valid (add a flag submitted)</li>
                        </ul>
                    </ol>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">With Form Group Directive</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (2/3)</h5>
                    <ol class="cap-white">
                        <li>Add general-info component (ng g c general-info)</li>
                        <ul class="cap-white">
                            <li>Add formGroupName (to the div in the template)</li>
                            <li>Add 2 matInputs: with first and last name</li>
                            <li>Define viewProviders ( provide: ControlContainer, useExisting: FormGroupDirective })
                            </li>
                            <li>Inject parent in the constructor (this.form = parent)</li>
                        </ul>
                    </ol>
                    <p>you're here now: nested/fgd-1-add-components-group-directive</p>
                    <p>material version: nested/fgd-2-final</p>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">With Form Group Directive</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (3/3)</h5>
                    <ol class="cap-white">
                        <li>Build the form structure in the general-info component</li>
                        <ul class="cap-white">
                            <li>Use addControl (this.form.form.addControl)</li>
                            <li>Add first and lastName controls</li>
                            <li>Add required validators for each field</li>
                            <li>Add mat-error to the template</li>
                            <li>Don't forget all needed imports in the order.module</li>
                        </ul>
                        <p>you're here now nested/fgd-2-final</p>
                    </ol>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Nested Forms</h3>
                    <h5 class="cap-white" style="color: #10e0ff">With Control Value Accessor</h5>
                    <ul class="cap-white">
                        <li>Pro: Reusable & portable</li>
                        <li>Pro: Best practise (Google)</li>
                        <li>Pro: Supports many nested levels</li>
                        <li>Cons: Implement interface</li>
                        <li>Cons: Problems with mat-error in Angular Material (if there is no form, only a control)
                        </li>
                    </ul>

                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">With Control Value Accessor</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Validation</h5>
                    <blockquote class="cap-white">
                        For Re-validation, the validators will need to be on the top-level form, not at the child
                        component,
                        if you want it to be part of the parent form’s validation.
                    </blockquote>

                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">With Control Value Accessor</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (1/5)</h5>
                    <ol class="cap-white">
                        <li>Pull or fork a repository from <a href="https://github.com/phhbr/forms-cva">here</a></li>
                        <li>Check out nested/cva-0-start</li>
                        <li>Add address component (ng g c address)</li>
                        <ul class="cap-white">
                            <li>Implement Control Value Accessor</li>
                            <li>Define form in the template [formGroup]="form"</li>
                            <li>Add following fields (as MatInputs): street, zipCode, city</li>
                            <p style="font-size:smaller">You can add an Address interface if you want</p>
                            <li>All the fields are required - add validators and mat-error</li>
                        </ul>
                    </ol>
                    <p>You're here now: nested/cva-1-initialized-address-component</p>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">With Control Value Accessor</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (2/5)</h5>
                    <ol class="cap-white">
                        <li>Implement CVA methods:</li>
                        <ul class="cap-white">
                            <li>Define address interface</li>
                            <li>In writeValue use setValue and set emitEvent as false (good for the performance)</li>
                            <li>Use valueChanges (from form) to subscribe on changes in the registerOnChange method</li>
                        </ul>
                    </ol>
                    <p class="cap-white">You're here now: nested/cva-2-finishing-basic-cva-implementation</p>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">With Control Value Accessor</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (3/5)</h5>
                    <ol class="cap-white">
                        <li>Implement Validator</li>
                        <li>Extend Component by Validator</li>
                        <li>Add Validators as provider</li>
                        <pre><code>
{
   provide: NG_VALIDATORS,
   useExisting: forwardRef(() => AddressComponent),
   multi: true
}
                    </code></pre>
                        <li>Implement validate method</li>
                        <p>You're here now: nested/cva-3-adding-validators</p>
                    </ol>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">With Control Value Accessor</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (3/5)</h5>
                    <ol class="cap-white">
                        <li>We need to know in the child if parent was submitted (parent has the submit button)</li>
                        <ul class="cap-white">
                            <li>Define in child @Input() isParentSubmitted</li>
                            <li>Implement OnChanges interface</li>
                            <li>We need a workaround in Angular Material to trigger a validation on submit (bug in
                                Angular
                                Material)
                            </li>
                        </ul>
                    </ol>
                    <pre><code>
   Object.keys(this.form.controls).forEach(key => {
      this.form.get(key).markAsTouched();
   });
                        </code></pre>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">With Control Value Accessor</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (4/5)</h5>
                    <ol class="cap-white">
                        <li>Use address component in order-overview</li>
                        <li>Set an Input in parent (order-overview) [isParentSubmitted]="submitted"
                        <li>Define in child @Input() isParentSubmitted</li>
                        <li>Add address as FormControl in parent (including formControlName)</li>
                    </ol>

                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">With Control Value Accessor</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (5/5)</h5>
                    <ol class="cap-white">
                        We want to fix the Validation of the nested CVA component
                        <li>Add Error State Matcher to Address Component</li>
                        <pre><code>
export class AddressErrorStateMatcher implements ErrorStateMatcher {
    isErrorState(control: FormControl | null, 
                 form: FormGroupDirective | NgForm | null): boolean {
        return control.invalid && control.touched;
    }
}
                            </code></pre>
                        <li>Use Error State Matcher in Providers</li>
                    </ol>
                    <p class="cap-white">You're here now: nested/cva-4-adding-error-state-matcher-and-submitted</p>
                </section>
            </section>
        </div>
    </div>

    <script src="./reveal.js/js/reveal.js"></script>

    <script>
        // More info https://github.com/hakimel/reveal.js#configuration
        Reveal.initialize({
            width: '100%',
            height: '100%',
            history: true,

            // More info https://github.com/hakimel/reveal.js#dependencies
            dependencies: [
                {
                    src: './reveal.js/lib/js/classList.js', condition: function () {
                        return !document.body.classList;
                    }
                },
                {
                    src: './reveal.js/plugin/markdown/marked.js', condition: function () {
                        return !!document.querySelector('[data-markdown]');
                    }
                },
                {
                    src: './reveal.js/plugin/markdown/markdown.js', condition: function () {
                        return !!document.querySelector('[data-markdown]');
                    }
                },
                {
                    src: './reveal.js/plugin/highlight/highlight.js', async: true, callback: function () {
                        hljs.initHighlightingOnLoad();
                    }
                },
                { src: './reveal.js/plugin/zoom-js/zoom.js', async: true },
                { src: './reveal.js/plugin/notes/notes.js', async: true }
            ]
        });
    </script>
    <script src="./js/main.js" type="module"></script>
</body>

</html>