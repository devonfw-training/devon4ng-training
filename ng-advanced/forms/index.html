<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Angular Advanced - Forms</title>


    <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
    <link rel="icon" href="./img/favicon.ico">
    <link rel="stylesheet" href="./reveal.js/css/reveal.css">
    <link rel="stylesheet" href="./reveal.js/css/theme/simple.css">
    <link rel="stylesheet" href="./css/common.css">
    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="./css/github-gist.css">
</head>

<body>
    <div class="reveal">
        <div class="slides">
            <section class="fullscreen"
                data-background="url(./img/Fixed_Shape_3_CapgeminiBlue_RGB.svg) no-repeat 0 500px">

                <h1>Forms</h1>
                <p>November 2023 State</p>
            </section>

            <section id="agenda-1" data-transition="slide"
                data-background-image="../common/img/shapes/Fixed_Shape_2_SVG/Fixed_Shape_2_CapgeminiBlue_RGB.svg">
                <h2 class="cap-white">Agenda</h2>
                <ul class="cap-white">
                    <li>Reactive Forms - A Recap</li>
                    <li>Custom Form Controls</li>
                </ul>
            </section>

            <section>
                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Reactive Forms</h3>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Reactive Forms</h3>
                    <h5 class="cap-white" style="color: #10e0ff">The form model defined in code as the source of truth
                    </h5>
                    <ul class="cap-white">
                        <li><strong>Scalable, reusable and testable </strong></li>
                        <li>They are <strong>synchronous</strong></li>
                        <li><strong>They are immutable</strong></li>
                    </ul>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Reactive Forms</h3>
                    <h5 class="cap-white">Example</h5>
                    <pre><code class="hljs typescript" data-trim>
interface LoginFormModel {
  email: FormControl&lt;string | null&gt;;
}
@Component({
  selector: "app-login",
  template: `
  &lt;form [formGroup]="loginForm" (submit)="submit()"&gt;
    &lt;input type="email" formControlName="email"&gt;
    &lt;input type="submit" value="submit"&gt;
  &lt;/form&gt;
  `
})
export class LoginComponent implements OnInit {
  loginForm: FormGroup&lt;LoginFormModel&gt;;

  ngOnInit() {
    this.loginForm = new FormGroup({
      email: new FormControl()
    });
  }

  submit() {
    console.log(this.loginForm.value);
  }

}
                </code>
                </pre>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Reactive Forms</h3>
                    <img src="img/reactive-forms.png" class="no-background no-border no-margin no-shadow">
					<p class="cap-white" style="font-size:smaller">see <a href="https://angular.io/guide/forms-overview">angular.io</a></p>
				</section>
            </section>

            <section>
                <section data-auto-animate
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Control Value Accessor (CVA)</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Enables Custom Form Control</h5>
                    <ul class="cap-white">
						<li>
							"[...] interface that acts as a <span style="color: #10e0ff">bridge</span>
							between the <span style="color: #10e0ff">Angular forms API</span> 
							and a <span style="color: #10e0ff">native element in the DOM</span>." (see <a href="https://angular.io/api/forms/ControlValueAccessor">angular.io</a>)
						</li>
						<li>
							Propagates changes from the <span
                            style="color: #10e0ff">model</span> to the <span
                            style="color: #10e0ff">view</span> and from the <span
                            style="color: #10e0ff">view</span> to the <span
                            style="color: #10e0ff">model</span>
						</li>
					</ul>
                </section>

                <section data-auto-animate
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Control Value Accessor (CVA)</h3>
                    <img src="img/cva.jpeg" class="no-background no-border no-margin no-shadow">
                    <!--Image taken from: https://blog.angularindepth.com/never-again-be-confused-when-implementing-controlvalueaccessor-in-angular-forms-93b9eee9ee83-->
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">CVA: Use Cases</h3>
                    <h5 class="cap-white" style="color: #10e0ff">With the Control Value Accessor we can</h5>
                    <ul class="cap-white">
                        <li>Create reusable, non-native form controls</li>
                        <li>Implement a core component library exposing form controls</li>
                        <li>Wrap web components without forms support</li>
                        <li>Divide complex forms into manageable, maintainable parts</li>
                    </ul>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Create reusable form controls</h3>
                    <h5 class="cap-white" style="color: #10e0ff">A "star" rating control</h5>
                    <img src="img/star-example.png" class="no-background no-border no-margin no-shadow">
                    <div>
                        <ul class="cap-white">
                            <li>Not natively supported control</li>
                            <li>Could have an implementation similar to</li>
                        </ul>
                    </div>
                    <pre><code class="hljs typescript" data-trim>
@Component({
    selector: "app-rate",
    template: `
       &lt;form (submit)="submit()"&gt;
         Rate this training: &lt;app-star-input (changeRating)="rating = $event"&gt;&lt;/app-star-input&gt;
         &lt;input type="submit" value="submit"&gt;
       &lt;/form&gt;
    `
  })
  export class RateComponent implements OnInit {
    rating: number;
  
    ngOnInit() {
    }
  
    submit() {
      console.log(this.rating);
    }
  }
                    </code></pre>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">But do we want that...?</h3>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Implementing CVA</h3>
                    <pre><code class="hljs typescript" data-trim>
interface RatingFormModel {
  rating: FormControl&lt;number | null&gt;;
}
@Component({
    selector: "app-rate",
    template: `
       &lt;form [formGroup]="ratingForm" (submit)="submit()"&gt;
         Rate this training: &lt;app-star-input formControlName="rating"&gt;&lt;/app-star-input&gt;
         &lt;input type="submit" value="submit"&gt;
       &lt;/form&gt;
    `
  })
  export class RateComponent implements OnInit {
    ratingForm: FormGroup&lt;RatingFormModel&gt;;
  
    ngOnInit() {
      this.ratingForm = new FormGroup({
           rating: new FormControl()
      });
    }
  
    submit() {
      console.log(this.ratingForm.value);
    }
  }
                    </code></pre>
                </section>

                <section data-auto-animate
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Control Value Accessor</h3>
                    <h5 class="cap-white" style="color: #10e0ff">API</h5>
                    <pre><code class="hljs typescript" data-trim>
interface ControlValueAccessor {
    // is the method that writes a new value from the form model
    // into the view or (if needed) DOM property
    writeValue(obj: any)
    // is a method that registers a handler that should be called
    // when something in the view has changed
    registerOnChange(fn: any)
    // it registers a handler specifically for when a control receives
    // a touch event
    registerOnTouched(fn: any)
    // is called when we disable or enable the form control. Can be used
    // to propagate the change to child components
    setDisabledState?(isDisabled: boolean): void;
}
                </code></pre>
                    <aside class="notes">
                        <ul>
                            <li>writeValue() - writes a new value to an element; the new value comes from the
                                MODEL(FormControl.setValue -> ControlValueAccessor.writeValue -> update element ->
                                change is visible in the UI) registerOnChange() - registers a
                                callback function that will</li>
                            <li>be called whenever the value changes in the UI and will propagate the new value to the
                                model. registerOnTouched() - registers a callback function that will be called when the
                                blur event occurs; the FormControl will be notified</li>
                            <li>of this event as it may need to perform some updates when this event occurs.
                                setDisabledState - will disable/enable the DOM element depending on the value provided;
                                this method is usually called as a result of a change in the
                                MODEL.</li>
                        </ul>
                    </aside>
                </section>

                <section data-auto-animate
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Control Value Accessor</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Implementation steps</h5>
                    <ul class="cap-white">
                        <li>Implement ControlValueAccessor interface and implement its methods</li>
                        <li>Register ControlValueAccessor (in a Component)</li>
                    </ul>
                    <pre><code class="hljs typescript" data-trim>
providers: [
    {
      provide: NG_VALUE_ACCESSOR,
      useExisting: forwardRef(() => CustomComponent),
      multi: true
    }
  ]
                </code></pre>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Implementing the interface in our custom component</h3>
                    <pre><code class="hljs typescript" data-trim>
@Component({
    selector: 'app-rating',
    providers: [
        {
            provide: NG_VALUE_ACCESSOR,
            useExisting: forwardRef(() => RatingComponent),
            multi: true
        }
    ],
    templateUrl: './rating.component.html'
})
export class RatingComponent implements ControlValueAccessor {
    rating = 0;
    isDisabled = false;

    private onChange = (rating: number) => {};
    private onTouched = () => {};

    writeValue(rating: number) {
        this.rating = rating;
    }

    registerOnChange(fn: (rating: number) => void) {
        this.onChange = fn;
    }

    registerOnTouched(fn: () => void) {
        this.onTouched = fn;
    }

    setDisabledState(isDisabled: boolean) {
        this.isDisabled = isDisabled;
    }
}
                </code></pre>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Control Value Accessor</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (1/5)</h5>
                    <ol class="cap-white">
                        <li>Pull or fork a repository from <a
                                href="https://github.com/devonfw-ng-adv-training/forms-simplified">here</a></li>
                        <li>Check out the rating/1-baseline state</li>
                        <li>Familiarize yourself with the code</li>
                    </ol>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Control Value Accessor</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (2/5)</h5>
                    <p class="cap-white">We want to refactor the RatingComponent to implement the CVA interface.
                    </p>
                    <ol class="cap-white">
                        <ul>
                            <li>
                                Implement the ControlValueAccessor interface for the RatingComponent class
                            </li>
                            <li>
                                Remove Input/Output properties
                            </li>
                            <li>
                                Remove Input/Output bindings. Directly bind to the FormControl using the formControlName
                                directive
                            </li>
                        </ul>
                    </ol>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Control Value Accessor</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (3/5)</h5>
                    <ol class="cap-white">
						<p style="font-size:smaller">fallback branch: rating/2-implement-cva</p>
                        <p class="cap-white">Add validation & opt-out</p>
                        <ul>
                            <li>Add a required validator to the rating form control</li>
                            <li>Add a checkbox for the user to opt-out of the rating:</li>
                            <ul>
                                <li>When the checkbox is checked, disable and reset the rating control</li>
                                <li>When the checkbox is unchecked, enable the rating control</li>
                            </ul>
                            <li>Test your application. See, how the reactive forms handle enabled/disabled state in combination with validation</li>
                        </ul>
                    </ol>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Control Value Accessor</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (4/5)</h5>
                    <ul class="cap-white">
						<p style="font-size:smaller">fallback branch: rating/3-validation-opt-out</p>
                        <p class="cap-white">Reuse the custom control</p>
                        <li>Add another control to the form group for an overall site rating</li>
                        <li>Reuse the RatingComponent</li>
                    </ul>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Control Value Accessor</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (5/5)</h5>
                    <ul class="cap-white">
						<p style="font-size:smaller">fallback branch: rating/4-reusability</p>
                        <p class="cap-white">Add custom validation</p>
                        <li>Add a custom validator to the "registration rating" (not overall site rating) form control to only allow ratings greater than 3</li>
                        <li>Show a validation message if the custom validation failed and the control was touched by the user</li>
                        <p style="font-size:smaller">final solution branch: rating/5-custom-validation</p>
                    </ul>
                </section>
            </section>


            <section>
                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Nested Forms</h3>
                    <h5 class="cap-white" style="color: #10e0ff">With Control Value Accessor</h5>
                    <ul class="cap-white">
                        <li>Pro: Reusable & portable</li>
                        <li>Pro: Best practice (Google)</li>
                        <li>Pro: Supports many nested levels</li>
                        <li>Cons: Implement interface</li>
                        </li>
                    </ul>

                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Nested Forms</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Validation</h5>
                    <blockquote class="cap-white">
                        For Re-validation, the validators will need to be on the top-level form, not at the child
                        component, if you want it to be part of the parent forms validation.
                    </blockquote>

                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Nested Forms</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Validator API</h5>
                    <pre><code class="hljs typescript" data-trim>
interface Validator {
    // is the method that is called for validation
    validate(control: AbstractControl): ValidationErrors | null
}
                </code></pre>
                    <aside class="notes">
                        <ul>
                            <li>validate() - called when the form data changes. Returns ValidationErrors if the form is invalid, otherwise null</li>
                        </ul>
                    </aside>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Nested Forms</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Validator implementation steps</h5>
                    <ul class="cap-white">
                        <li>Implement Validator interface and implement its methods</li>
                        <li>Register Validator (in a Component)</li>
                    </ul>
                    <pre><code class="hljs typescript" data-trim>
providers: [
    {
      provide: NG_VALIDATORS,
      useExisting: forwardRef(() => CustomComponent),
      multi: true
    }
  ]
                </code></pre>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Implementing the interface for a nested form</h3>
                    <pre><code class="hljs typescript" data-trim>
@Component({
    selector: 'app-address',
    providers: [
        { /* CVA provider */ },
        {
            provide: NG_VALIDATORS,
            useExisting: forwardRef(() => AddressComponent),
            multi: true
        }
    ],
    templateUrl: './address.component.html'
})
export class AddressComponent implements ControlValueAccessor, Validator {
    addressForm: FormGroup&lt;AddressFormModel&gt;;

    validate(): ValidationErrors | null {
        return addressForm.valid ? null : { invalidAddressData: true };
    }

    // CVA implementation starts here...
}
                </code></pre>
                <aside class="notes">
                    <ul>
                        <li>CVA implementation omitted for space reasons</li>
                    </ul>
                </aside>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Nested Forms</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (1/5)</h5>
                    <ol class="cap-white">
                        <li>Pull or fork a repository from <a
                                href="https://github.com/devonfw-ng-adv-training/forms-simplified">here</a></li>
                        <li>Make sure you are on the master branch</li>
						<li>We will focus on order</li>
                        <li>Add address properties to form</li>
                        <ul>street, zip, city, country</ul>
                    </ol>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Nested Forms</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (2/5)</h5>
					<p class="cap-white" style="font-size:smaller">fallback branch: nested/1-including-address</p>
                    <ol class="cap-white">
                        <li>prepare address</li>
                        <ul class="cap-white">
                            <li>generate address component</li>
                            <li>move forms part of address to component</li>
                        </ul>
                    </ol>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Nested Forms</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (3/5)</h5>
					<p class="cap-white" style="font-size:smaller">fallback branch: nested/2-extracted-address</p>
                    <ol class="cap-white">
                        <li>implement CVA interface to address</li>
                        <li>In writeValue use setValue and set emitEvent as false (good for the performance)</li>
                    </ol>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Nested Forms</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (4/5)</h5>
					<p class="cap-white" style="font-size:smaller">fallback branch: nested/3-basic-cva-implementation</p>
                    <ol class="cap-white">
                        <li>refactor general address to invoice address & delivery address in order</li>
                    </ol>
                </section>

                <section
                    data-background-image="../common/img/shapes/Fixed_Shape_3_SVG/Fixed_Shape_3_CapgeminiBlue_RGB.svg">
                    <h3 class="cap-white">Nested Forms</h3>
                    <h5 class="cap-white" style="color: #10e0ff">Exercise (5/5) - Optionals</h5>
                    <p class="cap-white" style="font-size:smaller">fallback branch:
                        nested/4-introducing-delivery-and-invoice-address</p>
					<ol class="cap-white">
                        <li>add validators to form</li>
                        <li>add validation to address component</li>
                    </ol>
                    <p class="cap-white" style="font-size:smaller">solution branch:  nested/5-added-validator</p>
                </section>
            </section>
        </div>
    </div>

    <script src="./reveal.js/js/reveal.js"></script>

    <script src="../common/reveal-config.js"></script>
    <script>
        // More info https://github.com/hakimel/reveal.js#configuration
        Reveal.initialize({
            ...revealConfig
        });
    </script>
    <script src="./js/main.js" type="module"></script>
</body>

</html>